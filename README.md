# Student Dashboard Backend

## What is this about?

This is the full stack application for a student dashboard application. It allows students to manage their courses and track assignments/tasks that are due on certain dates. The API handles user authentication, course management, and the tracking of tasks via features such as marking them as completed, filtering by status, and more.
User Management: registration, login, and profile management of users is enabled through secure session-based authentication.

## What is this used for?

- **User Management**: Register, login, and manage user profiles with  session-based authentication which is secure and efficient.
- **Course Management**: Create and organize courses, e.g "Math 101", "Computer Science"
- **Task tracking**: Add tasks/assignments to courses with deadlines, mark them complete, and filter pending vs completed tasks
- **Authorization**: Each user can only modify his/her own courses and tasks 


## Technical Stack (Backend)

| Layer | Technology | Purpose |
|-------|------------|---------|
| **API** | GraphQL (Apollo Server) | Query language for flexible data fetching |
| **Server** | Express.js | Node.js web framework |
| **Database** | PostgreSQL | Relational database for persistent storage |
| **ORM** | Prisma | Type-safe database queries and migrations |
| **Sessions** | Redis | Fast in-memory session storage |
| **Auth** | bcrypt | Password hashing |
| **Reverse Proxy** | Traefik | Load balancing and rate limiting |
| **Containerization** | Docker Compose | Multi-container orchestration |
| **Testing** | Jest | Unit testing framework |

## Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│                         CLIENT REQUEST                          │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                     TRAEFIK (Port 80)                           │
│              • Reverse Proxy & Load Balancer                    │
│              • Rate Limiting (100 req/s)                        │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                   EXPRESS + APOLLO SERVER                       │
│                      (GraphQL API)                              │
│  ┌─────────────┐  ┌─────────────┐     ┌──────────────┐          │
│  │   Auth      │  │   Course    │     │   Task       │          │
│  │  Resolver   │  │  Resolver   │     │  Resolver    │          │
│  └─────────────┘  └─────────────┘     └──────────────┘          │
└─────────────────────────────────────────────────────────────────┘
                │                               │
                ▼                               ▼
┌───────────────────────────┐     ┌───────────────────────────────┐
│         REDIS             │     │        POSTGRESQL             │
│   • Session Storage       │     │   • Users, Courses, Tasks     │
│   • Fast Key-Value Store  │     │   • Prisma ORM                │
└───────────────────────────┘     └───────────────────────────────┘
```

### Request Flow Example (Login → Create Task)

1. **User sends login request** → Traefik routes to backend
2. **Backend validates credentials** → Creates session in Redis
3. **Session cookie returned** → Stored in browser
4. **User creates a task** → Session verified via Redis
5. **Task saved** → PostgreSQL via Prisma
6. **Response returned** → Through Traefik to client

## Project Structure

```
backend/
├── graphql/
│   ├── resolvers/        # All the resolver functions are defined here which are basically the logic of backend.
│   └── schema/           # Here all the GraphQL type definitions are defined.
├── prisma/
│   ├── schema.prisma     # Database models are defined here and also the prisma config like datasource and generator.
│   └── migrations/       # Migration files generated by Prisma Migrate. (database versioning)
├── redis/                # Session configuration for Redis 
├── utils/                # Auth middleware (requireAuth, requireOwnership)
├── __tests__/            # Unit tests are defined here using Jest framework
└── index.js              # Application entry point 
```

### GraphQL mutations and queries

You can find the full list of GraphQL mutations and queries in the `graphql/schema` and `graphql/resolvers` folder as well as in the `server.js` file where the Apollo Server is initialized.

## Testing

The project uses **Jest** as the testing framework with a dedicated test database to ensure isolated and reliable test.  

### Test Database Setup

- Tests run against a separate PostgreSQL test database (configured via `TEST_DATABASE_URL`)
- The test database client is a singleton (`lib/testDb.js`) meaning it is shared across all tests to avoid multiple connections
- Tests run serially (`maxWorkers: 1` in Jest config file) to avoid database conflicts and deadlocks. 

### Test Structure

Test files are located in `backend/__tests__/`:
- `authentication.test.js` - User registration and login
- `user_resolver.test.js` - User profile operations
- `course_resolver.test.js` - Course CRUD operations
- `task_resolver.test.js` - Task management and filtering

### Test Configuration

- **Environment**: Tests run with `NODE_ENV=test`
- **Database**: Uses `TEST_DATABASE_URL` from `.env` file
- **Setup**: `jest.setup.js` configures the test environment
- **Pattern**: Test files match `**/__tests__/**/*.test.js`

